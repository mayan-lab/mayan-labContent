"use strict";

let mineralsjsontemplate = {
    "name": "Mineral",
    "name_zh": "矿物",
    "abbreviation": null,
    "formula": null,
    "latex_formula": null,
    "description": "",
    "description_zh": "自然晶体",
    "url": [
        {
            "index": "#",
            "img_url": "#",
        }
    ],
    "parent": null,
    "children": [
        {

        },

    ]

};
let mineralsjson = {
    "name": "Mineral",
    "name_zh": "矿物",
    "abbreviation": null,
    "formula": null,
    "latex_formula": null,
    "description": "",
    "description_zh": "自然晶体",
    "url": [
        {
            "index": "#",
            "img_url": "#",
        }
    ],
    "parent": null,
    "children": [
        {
            "name": "Native elements",
            "name_zh": "自然元素矿物",
            "abbreviation": null,
            "formula": null,
            "latex_formula": null,
            "description": "",
            "description_zh": "",
            "url": [
                {
                    "index": "#",
                    "img_url": "#",
                }
            ],
            "parent": "Mineral",
            "children": [
                {
                    "name": "Copper",
                    "name_zh": "自然铜",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Native elements",
                    "children": [

                    ]
                },
                {
                    "name": "Gold",
                    "name_zh": "自然金",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Native elements",
                    "children": [

                    ]
                },
                {
                    "name": "Silver",
                    "name_zh": "自然银",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Native elements",
                    "children": [

                    ]
                },
                {
                    "name": "Platinum",
                    "name_zh": "自然铂",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Native elements",
                    "children": [

                    ]
                },
                {
                    "name": "Selenium",
                    "name_zh": "自然硒",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Native elements",
                    "children": [

                    ]
                },

            ]
        },
        {
            "name": "Intermetallic compound",
            "name_zh": "金属互化物矿物",
            "abbreviation": null,
            "formula": null,
            "latex_formula": null,
            "description": "",
            "description_zh": "",
            "url": [
                {
                    "index": "#",
                    "img_url": "#",
                }
            ],
            "parent": "Mineral",
            "children": [
                {
                    "name": "Luobushaite",
                    "name_zh": "罗布砂矿",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Intermetallic compound",
                    "children": [

                    ]
                },
                {
                    "name": "Zangboite",
                    "name_zh": "藏布矿",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Intermetallic compound",
                    "children": [

                    ]
                },
                {
                    "name": "Tongbaite",
                    "name_zh": "桐柏矿",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Intermetallic compound",
                    "children": [

                    ]
                },

            ]
        },
        {
            "name": "Sulfide mineral",
            "name_zh": "硫化物矿物",
            "abbreviation": null,
            "formula": null,
            "latex_formula": null,
            "description": "",
            "description_zh": "自然晶体",
            "url": [
                {
                    "index": "#",
                    "img_url": "#",
                }
            ],
            "parent": "Mineral",
            "children": [
                {
                    "name": "Pyrite",
                    "name_zh": "黄铁矿",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "自然晶体",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Sulfide mineral",
                    "children": [

                    ]
                },
                {
                    "name": "Marcasite",
                    "name_zh": "白铁矿",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "自然晶体",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Sulfide mineral",
                    "children": [

                    ]
                },
                {
                    "name": "Marcasite",
                    "name_zh": "白铁矿",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "自然晶体",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Sulfide mineral",
                    "children": [

                    ]
                },

            ]
        },
        {
            "name": "Oxide and hydroxide mineral",
            "name_zh": "氧化物和氢氧化物矿物",
            "abbreviation": null,
            "formula": null,
            "latex_formula": null,
            "description": "",
            "description_zh": "",
            "url": [
                {
                    "index": "#",
                    "img_url": "#",
                }
            ],
            "parent": "Mineral",
            "children": [
                {
                    "name": "Arsenolite",
                    "name_zh": "砷华",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Oxide and hydroxide mineral",
                    "children": [

                    ]
                },
                {
                    "name": "Rutile",
                    "name_zh": "金红石",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Oxide and hydroxide mineral",
                    "children": [

                    ]
                },

            ]
        },
        {
            "name": "Silicate mineral",
            "name_zh": "硅酸盐矿物",
            "abbreviation": null,
            "formula": null,
            "latex_formula": null,
            "description": "",
            "description_zh": "",
            "url": [
                {
                    "index": "#",
                    "img_url": "#",
                }
            ],
            "parent": "Mineral",
            "children": [
                {
                    "name": "Zircon",
                    "name_zh": "锆石",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Silicate mineral",
                    "children": [

                    ]
                },
                {
                    "name": "Garnet",
                    "name_zh": "石榴子石",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Silicate mineral",
                    "children": [

                    ]
                },
                {
                    "name": "Olivine",
                    "name_zh": "橄榄石",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Silicate mineral",
                    "children": [

                    ]
                },
                {
                    "name": "Andalusite",
                    "name_zh": "红柱石",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Silicate mineral",
                    "children": [

                    ]
                },

            ]
        },
        {
            "name": "Carbonate mineral",
            "name_zh": "碳酸盐矿物",
            "abbreviation": null,
            "formula": null,
            "latex_formula": null,
            "description": "",
            "description_zh": "",
            "url": [
                {
                    "index": "#",
                    "img_url": "#",
                }
            ],
            "parent": "Mineral",
            "children": [
                {
                    "name": "Calcite",
                    "name_zh": "方解石",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Carbonate mineral",
                    "children": [

                    ]
                },
                {
                    "name": "Magnesite",
                    "name_zh": "菱镁矿",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Carbonate mineral",
                    "children": [

                    ]
                },

            ]
        },
        {
            "name": "Sulfate mineral",
            "name_zh": "硫酸盐矿物",
            "abbreviation": null,
            "formula": null,
            "latex_formula": null,
            "description": "",
            "description_zh": "",
            "url": [
                {
                    "index": "#",
                    "img_url": "#",
                }
            ],
            "parent": "Mineral",
            "children": [
                {
                    "name": "Barite",
                    "name_zh": "重晶石",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Sulfate mineral",
                    "children": [

                    ]
                },
                {
                    "name": "Celestine",
                    "name_zh": "天青石",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Sulfate mineral",
                    "children": [

                    ]
                },
                {
                    "name": "Anhydrite",
                    "name_zh": "硬石膏",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Sulfate mineral",
                    "children": [

                    ]
                },

            ]
        },
        {
            "name": "Phosphate mineral",
            "name_zh": "磷酸盐矿物",
            "abbreviation": null,
            "formula": null,
            "latex_formula": null,
            "description": "",
            "description_zh": "",
            "url": [
                {
                    "index": "#",
                    "img_url": "#",
                }
            ],
            "parent": "Mineral",
            "children": [
                {
                    "name": "Monazite",
                    "name_zh": "独居石",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Phosphate mineral",
                    "children": [

                    ]
                },
                {
                    "name": "Apatite",
                    "name_zh": "磷灰石",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Phosphate mineral",
                    "children": [

                    ]
                },

            ]
        },
        {
            "name": "Borate mineral",
            "name_zh": "硼酸盐矿物",
            "abbreviation": null,
            "formula": null,
            "latex_formula": null,
            "description": "",
            "description_zh": "",
            "url": [
                {
                    "index": "#",
                    "img_url": "#",
                }
            ],
            "parent": "Mineral",
            "children": [
                {
                    "name": "Ludwigite",
                    "name_zh": "硼镁铁矿",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Borate mineral",
                    "children": [

                    ]
                },
                {
                    "name": "Ascharite",
                    "name_zh": "硼镁石",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Borate mineral",
                    "children": [

                    ]
                },

            ]
        },
        // {
        //     "name": "Tungstate, molybdate and chromate mineral",
        //     "name_zh": "钨酸盐、钼酸盐和铬酸盐矿物",
        //     "abbreviation": null,
        //     "formula": null,
        //     "latex_formula": null,
        //     "description": "",
        //     "description_zh": "",
        //     "url": [
        //         {
        //             "index": "#",
        //             "img_url": "#",
        //         }
        //     ],
        //     "parent": "Mineral",
        //     "children": [
        //         {
        //
        //         },
        //
        //     ]
        // },
        {
            "name": "Halide mineral",
            "name_zh": "卤化物矿物",
            "abbreviation": null,
            "formula": null,
            "latex_formula": null,
            "description": "",
            "description_zh": "",
            "url": [
                {
                    "index": "#",
                    "img_url": "#",
                }
            ],
            "parent": "Mineral",
            "children": [
                {
                    "name": "Fluorite",
                    "name_zh": "萤石",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Halide mineral",
                    "children": [

                    ]
                },
                {
                    "name": "Halite",
                    "name_zh": "石盐",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Halide mineral",
                    "children": [

                    ]
                },

            ]
        },
        {
            "name": "Organic, mineraloid mineral",
            "name_zh": "有机及准矿物",
            "abbreviation": null,
            "formula": null,
            "latex_formula": null,
            "description": "",
            "description_zh": "",
            "url": [
                {
                    "index": "#",
                    "img_url": "#",
                }
            ],
            "parent": "Mineral",
            "children": [
                {
                    "name": "Coal",
                    "name_zh": "煤",
                    "abbreviation": null,
                    "formula": null,
                    "latex_formula": null,
                    "description": "",
                    "description_zh": "",
                    "url": [
                        {
                            "index": "#",
                            "img_url": "#",
                        }
                    ],
                    "parent": "Organic, mineraloid mineral",
                    "children": [

                    ]
                },

            ]
        },

    ]

};

let width = 954;
let radius = width / 2;
let tree = d3.tree()
    .size([2 * Math.PI, radius])
    .separation((a, b) => (a.parent === b.parent ? 1 : 2) / a.depth);

let data = d3.hierarchy(mineralsjson);
    // .sum(d => d.children.length)
    // .sort((a, b) => d3.ascending(a.value, b.value));

function autoBox() {
    document.getElementById("mineraltree").appendChild(this);
    document.getElementById("mineraltree").setAttribute("style", "background-color:#FFF;");
    // d3.select("#demo1").appendChild(this);
    let {x, y, width, height} = this.getBBox();
    // document.getElementById("demo1").removeChild(this);
    console.log([x, y, width, height]);
    // d3.select("#demo1").removeChild(this);
    return [x, y, width, height];
}

let root = tree(data);
let svg = d3.create("svg");

svg.append("g")
    .attr("fill", "none")
    .attr("stroke", "#555")
    .attr("stroke-opacity", 0.4)
    .attr("stroke-width", 2)
    .selectAll("path")
    .data(root.links())
    .join("path")
    .attr("d", d3.linkRadial()
        .angle(d => d.x)
        .radius(d => d.y));

svg.append("g")
    .selectAll("circle")
    .data(root.descendants())
    .join("circle")
    .attr("transform", d => `
    rotate(${d.x * 180 / Math.PI - 90})
    translate(${d.y}, 0)`)
    .attr("fill", d => d.children ? "#555" : "#999")
    .attr("r", 2.5);

svg.append("g")
    .attr("font-family", "sans-serif")
    .attr("font-size", 16)
    .attr("stroke-linejoin", "round")
    .attr("stroke-width", 1)
    .selectAll("text")
    .data(root.descendants())
    .join("text")
    .attr("transform", d => `
    rotate(${d.x * 180 / Math.PI -90})
    translate(${d.y}, 0)
    rotate(${d.x >= Math.PI ? 180 : 0})`)
    .attr("dy", "0.31em")
    .attr("x", d => d.x < Math.PI === !d.children ? 6 : -6)
    .attr("text-anchor", d => d.x < Math.PI === !d.children ? "start" : "end")
    .text(d => d.data.name_zh)
    .clone(true).lower()
    .attr("stroke", "#555");

svg.attr("viewBox", autoBox).node();








